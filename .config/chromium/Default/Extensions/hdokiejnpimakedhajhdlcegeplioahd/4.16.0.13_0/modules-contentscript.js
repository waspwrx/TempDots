var LPModule,__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{u(n.next(e))}catch(e){r(e)}}function c(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,c)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}};!function(e){setTimeout(function(){e.initialize(),e.postInitialize()})}(LPModule||(LPModule={})),function(e){var t;(t=e.FeatureType||(e.FeatureType={})).NewSaveSite="new_save_site",t.WebRequestTracking="webreq_tracking",t.Ziggy="ziggy",t.Freamon="freamon",t.BetterGeneratePasswordEnabled="better_generate_password_enabled",t.IsInfieldEnabled="is_infield_enabled",t.IsMobileActive="is_mobile_active",t.OmarIa="omaria",t.EzpassControl="ezpass_control",t.EzpassTest="ezpass_test",t.FormfillMigration="formfill_migration",t.AngularFrontendEnabled="angularFrontendEnabled",t.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",t.FamilySharedFoldersEnabled="family_shared_folders_enabled",t.FamiliesEnabled="families_enabled",t.TryFamiliesEnabled="try_families_enabled",t.OmarDrawer="omardrawer",t.OmarInfieldB="omar_infield_b",t.OmarInfieldC="omar_infield_c",t.IsDogfood="isDogfood",t.OneToOneSharingRestricted="one_to_one_sharing_restricted",t.EmergencyAccessRestricted="emergency_access_restricted",t.TutorialEnabled="tutorial_enabled",t.HealthMonitoring="health_monitoring",t.ICOB="icob"}(LPModule||(LPModule={})),function(e){(e.RepositoryType||(e.RepositoryType={})).Feature="Feature"}(LPModule||(LPModule={})),function(e){var t;(t=e.ServiceType||(e.ServiceType={})).BasicAuth="BasicAuth",t.ContentScriptTools="ContentScriptTools",t.FormDetection="FormDetection",t.FormParser="FormParser",t.Segment="Segment",t.SiteParser="SiteParser",t.StringUtils="StringUtils",t.Topic="Topic",t.WebRequest="WebRequest"}(LPModule||(LPModule={})),function(e){var t;(t=e.TopicType||(e.TopicType={}))[t.LoginFinished=Topics.LOGIN_FINISHED]="LoginFinished",t[t.ClearData=Topics.CLEAR_DATA]="ClearData"}(LPModule||(LPModule={})),function(e){var t=new(function(){function e(){this.constructors={},this.repositories={}}return e.prototype.register=function(e,t){this.constructors[e]=t},e.prototype.initialize=function(){var e=this;Object.keys(this.constructors).forEach(function(t){return e.repositories[t]=new e.constructors[t]}),Object.keys(this.repositories).forEach(function(t){return e.repositories[t].initialize()})},e.prototype.getRepository=function(e){return this.repositories[e]},e}());e.getRepository=function(e){var i=t.getRepository(e);if(!i)throw new Error("Cannot find repository [ "+e+" ]");return i},function(e){e.initialize=function(){t.initialize()},e.register=function(e,i){t.register(e,i)}}(e.Repositories||(e.Repositories={}))}(LPModule||(LPModule={})),function(e){var t=new(function(){function e(){this.constructors={},this.services={}}return e.prototype.register=function(e,t){this.constructors[e]=t},e.prototype.initialize=function(){var e=this;Object.keys(this.constructors).forEach(function(t){return e.services[t]=new e.constructors[t]}),Object.keys(this.services).forEach(function(t){return e.services[t].initialize()})},e.prototype.getService=function(e){return this.services[e]},e}());e.getService=function(e){var i=t.getService(e);if(!i)throw new Error("Cannot find service [ "+e+" ]");return i},function(e){e.initialize=function(){t.initialize()},e.register=function(e,i){t.register(e,i)}}(e.Services||(e.Services={}))}(LPModule||(LPModule={})),function(e){var t,i,n;t=e.Services||(e.Services={}),i=t.Utils||(t.Utils={}),n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;++i)if(e.indexOf(t[i])>-1)return!0}return!1},e}(),i.StringUtilsService=n,t.register(e.ServiceType.StringUtils,n)}(LPModule||(LPModule={})),function(e){e.initialize=function(){e.Repositories.initialize(),e.Services.initialize()},e.postInitialize=function(){window.basicAuth=new e.Views.BasicAuth.BasicAuthView}}(LPModule||(LPModule={})),function(e){var t,i;t=e.Repositories||(e.Repositories={}),i=function(){function t(){}return t.prototype.initialize=function(){},t.prototype.get=function(t){var i=Array.from(arguments);return new Promise(function(t,n){bg.LPModule.Repositories.call(e.RepositoryType.Feature,"get",i,function(e,i){e?n(e):t(i)})})},t.prototype.set=function(t,i){bg.LPModule.Repositories.call(e.RepositoryType.Feature,"set",Array.from(arguments))},t}(),t.DelegatedFeatureRepository=i,t.register(e.RepositoryType.Feature,i)}(LPModule||(LPModule={})),function(e){var t,i;t=e.Services||(e.Services={}),i=function(){function t(){this.inputSelector='input:not([type]),input[type="text"],input[type="email"],input[type="password"]',this.successRegex=/^2[0-9][0-9]$/}return t.prototype.initialize=function(){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(n){switch(n.label){case 0:return this.segment=e.getService(e.ServiceType.Segment),this.tools=e.getService(e.ServiceType.ContentScriptTools),this.webRequest=e.getService(e.ServiceType.WebRequest),this.addTrustedListener("mouseup",function(e){return i.detectForm(e)}),this.addTrustedListener("keydown",function(e){13===(e.keyCode||e.which)&&i.detectForm(e)}),t=this,[4,this.getCurrentTabDetails()];case 1:return t.tabDetails=n.sent(),[2]}})})},t.prototype.detectForm=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o;return __generator(this,function(r){switch(r.label){case 0:return t=this.tools.getForm(e.target),i=this.getFormInputs(t),this.hasPasswordInput(i)?(n=i.map(function(e){return e.value}),[4,this.webRequest.getResponse(this.tabDetails.tabId,n)]):[3,2];case 1:o=r.sent(),this.isSuccessCode(o)&&this.segment.send("passwordsubmitted",{type:"webrequest"}),r.label=2;case 2:return[2]}})})},t.prototype.hasPasswordInput=function(e){var t=this;return e.some(function(e){return"password"===e.type||"disc"===t.tools.getCSS(e,"text-security")})},t.prototype.addTrustedListener=function(e,t){window.addEventListener(e,function(e){return e.isTrusted&&t(e)},!0)},t.prototype.getFormInputs=function(e){var t=this,i=e||document.body;return Array.from(i.querySelectorAll(this.inputSelector)).filter(function(e){return e.value&&t.tools.isVisible(e)})},t.prototype.isSuccessCode=function(e){return this.successRegex.test(e)},t.prototype.getCurrentTabDetails=function(){return new Promise(function(e,t){bg.LPPlatform.getCurrentTabDetails(function(t){e({windowId:t.windowID,tabUrl:t.tabURL,tabId:t.tabID})})})},t}(),t.FormDetectionService=i,t.register(e.ServiceType.FormDetection,i)}(LPModule||(LPModule={})),function(e){var t,i;t=e.Services||(e.Services={}),i=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){bg.sendLpImprove(e,t)},e}(),t.DelegatedSegmentService=i,t.register(e.ServiceType.Segment,i)}(LPModule||(LPModule={})),function(e){var t,i;t=e.Services||(e.Services={}),i=function(){function e(){this.unloading=!1}return e.prototype.initialize=function(){var e=this;window.addEventListener("beforeunload",function(t){!1!==t.isTrusted&&(e.unloading=!0)})},e.prototype.isUnloading=function(){return this.unloading},e.prototype.getCSS=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},e.prototype.isForm=function(e){return"FORM"===e.nodeName},e.prototype.getForm=function(e){for(;e;){if(this.isForm(e))return e;e=e.parentElement}return null},e.prototype.isClickable=function(e){if("function"==typeof document.elementFromPoint){var t=e.getBoundingClientRect();return document.elementFromPoint(t.left,t.top)===e||document.elementFromPoint(t.right,t.top)===e||document.elementFromPoint(t.left,t.bottom)===e||document.elementFromPoint(t.right,t.bottom)===e}return!0},e.prototype.isScrollableX=function(e){if(e.scrollWidth>e.clientWidth){var t=this.getCSS(e,"overflow-x");return"auto"===t||"scroll"===t}return!1},e.prototype.isScrollableY=function(e){if(e.scrollHeight>e.clientHeight)switch(this.getCSS(e,"overflow-y")){case"auto":case"scroll":return!0;case"visible":return e===document.body||!e.parentElement}return!1},e.prototype.getViewableArea=function(e){for(var t={top:0,left:0,width:window.innerWidth,height:window.innerHeight},i=e.parentElement;i;)i.scrollLeft>0&&(t.left-=i.scrollLeft),i.scrollTop>0&&(t.top-=i.scrollTop),this.isScrollableX(i)&&(t.width+=i.scrollWidth-i.clientWidth),this.isScrollableY(i)&&(t.height+=i.scrollHeight-i.clientHeight),i=i.parentElement;return t.right=t.left+t.width,t.bottom=t.top+t.height,t},e.prototype.isVisible=function(e){if(!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return!1;var t=e.getBoundingClientRect(),i=this.getViewableArea(e);return!(t.right<i.left||t.bottom<i.top||t.left>i.right||t.top>i.bottom)},e}(),t.ContentScriptTools=i,t.register(e.ServiceType.ContentScriptTools,i)}(LPModule||(LPModule={})),function(e){var t,i;t=e.Services||(e.Services={}),i=function(){function t(){this.apiSupported=!1}return t.prototype.initialize=function(){var t=this;bg.LPModule.Services.call(e.ServiceType.WebRequest,"isApiSupported",void 0,function(e,i){if(e)throw e;t.apiSupported=i})},t.prototype.getResponse=function(t,i){var n=Array.from(arguments);return new Promise(function(t,i){return bg.LPModule.Services.call(e.ServiceType.WebRequest,"getResponse",n,function(e,n){e?i(e):t(n)})})},t.prototype.isApiSupported=function(){return this.apiSupported},t}(),t.DelegatedWebRequestService=i,t.register(e.ServiceType.WebRequest,i)}(LPModule||(LPModule={})),function(e){var t,i,n;t=e.Views||(e.Views={}),i=t.BasicAuth||(t.BasicAuth={}),n=function(){function e(){var e=this;bg.basicAuth.hasFeature(function(t){t&&bg.basicAuth.isBasicAuth(function(t,i){return e.init(t,i)})})}return e.prototype.init=function(e,t){var i=this;e&&(this.backgroundInterface=bg,this.loadContent(function(){i.initContent(t)}))},e.prototype.loadContent=function(e){var t=this;$.get(chrome.runtime.getURL("/content-script/views/basic-auth/basic-auth.html"),function(i){var n=t.replaceRelativePaths(i);$(document.body).empty().append(n),e()})},e.prototype.initContent=function(e){$("#ba_username").focus(),e||$("#wronguserpass").hide(),document.title="Lastpass basic auth login",$("#title").text(location.host),"http:"===location.protocol?$("#secureWarning").show():$("#secureWarning").hide(),this.subscribeEvents(),this.openPopupNotification(),this.backgroundInterface.sendLpImprove("basicauth::triggered")},e.prototype.subscribeEvents=function(){var e=this;$("#lp-login-btn").click(function(){$(".js-notification").toggle("notification-visible"),e.doLogin()}),$("#password").keypress(function(t){13===t.which&&e.doLogin()}),$("#lp-cancel-btn").click(function(){e.cancelBasicAuth(),e.backgroundInterface.sendLpImprove("basicauth::cancel")}),$(".notification__close__button").click(function(){$(".notification__body").removeClass("slide-in").addClass("slide-out"),e.backgroundInterface.basicAuth.closeNotification()})},e.prototype.doLogin=function(){var e=$("#ba_username").val(),t=$("#ba_password").val();this.backgroundInterface.sendLpImprove("basicauth::login"),this.backgroundInterface.basicAuth.setAuthCredential(e,t,function(){return location.reload()})},e.prototype.cancelBasicAuth=function(){this.backgroundInterface.basicAuth.cancelBasicAuth(),$("#login-body").hide(),location.reload()},e.prototype.replaceRelativePaths=function(e){var t=chrome.runtime.getURL("");return e.replace(new RegExp("{extensionUrl}","g"),t)},e.prototype.openPopupNotification=function(){this.backgroundInterface.basicAuth.isNotificationClosed(function(e){e?$(".notification__body").hide():$(".notification__body").addClass("slide-in")})},e}(),i.BasicAuthView=n}(LPModule||(LPModule={}));
//# sourceMappingURL=sourcemaps/modules-contentscript.js.map
