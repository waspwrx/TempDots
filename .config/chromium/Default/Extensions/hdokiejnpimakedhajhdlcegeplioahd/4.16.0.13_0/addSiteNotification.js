LPSiteNotification=function(){var e,t,n,r,i,a,o,u,s,c,l,f,d,p,g=!1,v=!1,m=!1,b=function(e){for(var t=0;t<e.fields.length;++t)if("password"===e.fields[t].type)return!0;return!1},T=(e=!1,function(t){e||(e=!0,setTimeout(function(){e=!1},0),b(t)?(t.generatedPassword||(g=!0),bg.LPTabState.processPasswordSubmit({formData:t,callback:t.generatedPassword||LPContentScriptTools.isUnloading()?null:w})):t.fields.length>0&&(bg.LPTabState.processTextSubmit(t),bg.LPTabState.clear()))}),h=function(e){var t=function(e){for(var t,n=[],r=(e||document.body).querySelectorAll('input:not([type]),input[type="text"],input[type="email"],input[type="password"]'),i=0;i<r.length;++i)(t=r[i]).value&&(t.value!==t.getAttribute("value")||t.value.length>1)&&LPContentScriptTools.isVisible(t)&&n.push(r[i]);return n}(e.form);e.form&&(t=function(e){for(var t=[],n={},r={},i=e.length<1e3?e.length:1e3,a=0;a<i;++a){var o=e[a];switch(o.type){case"hidden":case"text":case"email":!o.value||"hidden"!==o.type&&LPContentScriptTools.isVisible(o)||(n.hasOwnProperty(o.value)?delete r[o.value]:(r[o.value]=o,n[o.value]=!0))}}var u={};return LPContentScriptTools.findTextNodes({searches:Object.keys(r),searchAll:!0,exactMatch:!0,allowEmails:!0}).filter(function(e){return!u.hasOwnProperty(e.match)&&(u[e.match]=!0,!0)}).forEach(function(e){e.parent&&"OPTION"!==e.parent.nodeName&&LPContentScriptTools.isVisible(e.parent)&&t.push(r[e.match])}),t}(e.form).concat(t));for(var n,r,i=[],a=0;a<t.length;++a){var o=t[a],u=(r=void 0,"password"!==(r={type:(n=o).type,value:n.value,id:n.id,label:LPContentScriptTools.getLabel(n),attributes:LPContentScriptTools.getAttributes(n,["name","ng-model","data-reactid"])}).type&&"disc"===LPContentScriptTools.getCSS(n,"text-security")&&(r.type="password"),r);i.push({input:o,inputData:u})}var s=function(e,t){for(var n=[],r=0;r<e.length;++r){var i=e[r];"password"!==i.inputData.type&&(i.inputData.value=N.getUnmaskedValue({input:i.input,inputValue:i.inputData.value,form:t.form})),i.inputData.formname=t.form&&t.form.getAttribute("name")||"",n.push(i.inputData)}return{url:document.location.href,top:window===top,fields:n,generatedPassword:t.generatedPassword,username:N.getUsername()}}(i,e);return e.deferred||T(s),s},S=(t=null,n=function(){t=null},function(e){return function(r){if(t=!1!==r.isTrusted&&!1!==t)try{e(r)}catch(e){Raven.captureException(e)}setTimeout(n,0)}}),L=(i=function(e){if(e.id)return document.getElementById(e.id);for(var t in e.attributes){var n=document.querySelector("input["+t+'="'+e.attributes[t]+'"]');if(n)return n}return null},a=function(e,t){for(var n=0;n<e.fields.length;++n){var r=e.fields[n];if("password"===r.type)return o=e,u=t,void 0,!(!(s=i(a=r))||!LPContentScriptTools.isVisible(s)||(u&&!LPContentScriptTools.isClickable(s)?(v=!0,1):o.passwordChangeForm&&s.value!==a.value))}var a,o,u,s;return!1},r=function(e,t){var n=i(e);n&&n.addEventListener("input",S(function(){t(!0)}))},o=function(e,t){for(var n=0;n<e.fields.length;++n){var i=e.fields[n];"password"===i.type&&r(i,t)}},function(e,t){var n=0,r=null,i=!1,u=function(e){i||(g=!1,i=!0,clearInterval(r),t(e))};g?(r=setInterval(function(){var t=5==++n,r=a(e,t);r&&!t||u(r)},1e3),o(e,u)):u(a(e))}),w=function(e){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(e),bg.get("LPContentScriptFeatures").new_save_site&&e.dialogData&&!v&&(csTop.LPSiteNotification.showSiteNotification(e),bg.sendTimingEvent("addSite","pause")))},P=(u=function(e){return(e=e.toLowerCase()).indexOf("submit")>-1||e.indexOf("save")>-1},s=function(e){for(var t=e.attributes,n=0;n<t.length;++n){var r=t[n];if(u(r.name)||u(r.value))return!0}return!1},function(e){if("INPUT"===e.nodeName)return"submit"===e.type||"button"===e.type&&s(e);for(var t=e;t&&0===t.getElementsByTagName("input").length;){if("BUTTON"===t.nodeName)return"submit"===t.type||s(t);if(s(t))return!0;t=t.parentElement}return!1}),C=function(e){switch(e.nodeName){case"TEXTAREA":case"SELECT":return!0;case"INPUT":switch(e.type){case"button":case"submit":return!1;default:return!0}default:return!1}},y=(c=null,l=[],d=function(e){(function(e){for(var t=0;t<e.length;++t){var n=e[t];switch(n.type){case"attributes":if(n.target.getAttribute(n.attributeName)!==n.oldValue)return!0;break;default:return!0}}return!1})(e)&&(l.forEach(function(e){e()}),f())},{reset:f=function(){c&&(c.disconnect(),c=null),l=[]},onChange:function(e){"undefined"!=typeof MutationObserver&&(c||(c=new MutationObserver(d)).observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0}),-1===l.indexOf(e)&&l.push(e),setTimeout(function(){f()},0))}}),E=(p=[],{startTracking:function(e,t){var n=function(r){if(e(r.detail)){window.removeEventListener("lprequeststart",n);var i=function(e){r.detail.requestID===e.detail.requestID&&(window.removeEventListener("lprequestend",i),t(e.detail))};window.addEventListener("lprequestend",i)}};window.addEventListener("lprequeststart",n),p.push(n)},stopTracking:function(){p.forEach(function(e){window.removeEventListener("lprequeststart",e)}),p=[]}}),N=function(){var e=null,t=!1,n=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(e){i({target:e.element,generatedPassword:e.password})}),Topics.get(Topics.CLEAR_DATA).subscribe(function(e){p()}),Topics.get(Topics.LOGIN).subscribe(function(e){bg.LPTabState.getState(function(e){e.enabled&&d(e)})});var r,i=function(e){return e.form=LPContentScriptTools.getForm(e.target),h(e)},a=function(){g=!1,bg.LPTabState.clear()},o=function(e){var t=e&&e.formData;t&&t.fields.length>0&&(E.stopTracking(),E.startTracking(function(e){if(e&&e.data)for(var n=function(e){try{return decodeURIComponent(e)}catch(e){}return null}(e.data),r=0;r<t.fields.length;++r){var i=t.fields[r].value;if(n&&n.indexOf(i)>-1||e.data.indexOf(i)>-1)return!0}return!1},e.responseHandler))},u=(r=/^2[0-9][0-9]$/,function(e){return r.test(e)}),s=function(e){return bg.get("LPContentScriptFeatures").webreq_tracking&&LPModule.getService("WebRequest").isApiSupported()&&b(e)},c=function(e){o({formData:e,responseHandler:function(t){u(t.statusCode)?s(e)&&bg.sendLpImprove("passwordsubmitted",{type:"inject"}):a()}})},l=function(e){var t=i({target:e,deferred:!0});o({formData:t,responseHandler:function(e){u(e.statusCode)&&(T(t),s(t)&&bg.sendLpImprove("passwordsubmitted",{type:"inject"}))}})},f={submit:S(function(e){y.reset(),c(h({form:LPContentScriptTools.getForm(e.target),type:e.type}))}),lpsubmit:function(e){y.reset(),h({form:e.target,type:"submit"})},mouseup:S(function(e){var t=e.target;P(t)?(y.reset(),c(i({target:t,type:e.type}))):C(t)||(g&&y.onChange(a),l(t))}),keydown:S(function(e){if(13===(e.keyCode||e.which)){var t=e.target;C(t)||P(t)?(y.reset(),c(i({target:t,type:e.type}))):(g&&y.onChange(a),l(t))}}),change:S(function(e){var t=e.target;if("INPUT"===t.nodeName&&t.value)switch(t.type){case"text":case"email":for(var r=0;r<n.length;++r)if(n[r].input===t)return void(n[r].value=t.value);n.push({input:t,value:t.value})}}),paste:S(function(e){var t=e.target;C(e.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(e){t.value===e&&i({target:t,generatedPassword:e})})})},d=function(n){if(e=n,!t){for(var r in f)document.addEventListener(r,f[r],!0);t=!0}},p=function(){if(t){for(var e in f)document.removeEventListener(e,f[e],!0);t=!1}n=[]},v=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1};return function(){var e=document.documentElement;if(e&&"HTML"===e.nodeName)if(g_ischrome){var t=document.createElement("script");t.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents)),e.appendChild(t),e.removeChild(t)}else Topics.get(Topics.INITIALIZED).subscribe(function(){var t=bg.get("extensionBaseURL");if(t){var n=document.createElement("script");n.src=t+"pageWebRequestEvents.js",e.appendChild(n),e.removeChild(n)}})}(),{setup:d,teardown:p,getUnmaskedValue:function(e){if(v(e.inputValue)){var t;for(t=0;t<n.length;++t){var r=n[t];if(r.input===e.input&&r.value!==e.inputValue)return r.value}if(e.form)for(t=0;t<e.form.length;++t){var i=e.form[t];if(a=i,o=e.inputValue,a.value&&!v(a.value)&&a.value.length===o.length&&(a.value[0]===o[0]||a.value[a.value.length-1]===o[o.length-1]))return i.value}}var a,o;return e.inputValue},getUsername:function(){if(e.usernames&&e.usernames.length>0)return LPContentScriptTools.findText({searches:e.usernames,wordMatch:!0})}}}(),I=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:w})},1e3,!0);return Topics.get(Topics.INITIALIZED).subscribe(function(){bg.get("LPContentScriptFeatures").new_save_site&&bg.sendTimingEvent("addSite","start"),bg.LPTabState.getState(function(e){e.enabled&&(N.setup(e),window===top?I():e.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())})}),window!==top&&window.addEventListener("beforeunload",function(){g&&csTop.LPSiteNotification.getSiteNotification()},!0),{formExists:L,showSiteNotification:function(e){if(!m){if(m=!0,e.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(t)},bg.get("LPContentScriptFeatures").angularFrontendEnabled)var t=LPFrame.openAngularDialog("save-new",e,{css:{top:0,right:0}});else t=LPFrame.openDialog("contentScriptSite",e,{css:{top:10,right:10}});t.onClose(function(){m=!1})}},getSiteNotification:I}}();
//# sourceMappingURL=sourcemaps/addSiteNotification.js.map
