var lp=lp||{};lp.pushClient=function(){var e=null,n=0,c=null,o=6e4;function t(t,i,l){var r;console.log("connecting to "+t+" chan: "+i),t=t.replace(/^http(s?):/gi,"ws$1:"),r=t,"undefined"!=typeof WebSocket?e=new WebSocket(r):"undefined"!=typeof MozWebSocket&&(e=new MozWebSocket(r)),setTimeout(function(){s(t,i,l)},o),e.onopen=function(){a({channel:"/meta/handshake",version:"1.0",supportedConnectionTypes:["callback-polling"]}),n=!0},e.onclose=function(e){n=!1,clearTimeout(c);var o=1e3*(10+Math.floor(60*Math.random()));console.log("push_server retrying in "+o+"ms onclose: "+e.code+" "+e.reason),c=setTimeout(function(){s(t,i,l)},o)},e.onmessage=function(e){try{n=!0;var c=JSON.parse(e.data)[0];switch(c.channel){case"/meta/connect":a({clientId:c.clientId,connectionType:"websocket",channel:"/meta/connect"});break;case"/meta/handshake":c.successful&&(a({clientId:c.clientId,connectionType:"websocket",channel:"/meta/connect"}),a({clientId:c.clientId,subscription:i,channel:"/meta/subscribe"}));break;case"/ping":case"/meta/subscribe":break;case i:void 0!==c.data.av_update&&l()}}catch(e){console.log("Caught error "+e)}}}function a(n){e&&e.readyState===e.OPEN&&e.send(JSON.stringify(n))}function s(e,a,i){clearTimeout(c),n?c=setTimeout(function(){s(e,a,i)},o):t(e,a,i)}return{connect:t,disconnect:function(){console.log("push_server_disconnect!"),clearTimeout(c),e&&(e.onclose=e.onerror=null,e=null,n=!1)}}}();
//# sourceMappingURL=sourcemaps/push_client.js.map
