function loadConfig(path,callback){var xhr=new XMLHttpRequest;xhr.open("GET",chrome.extension.getURL(path),true);xhr.onload=function(){var json=JSON.parse(xhr.responseText);if(json!=null)callback(json)};xhr.send()}function createNotificationId(code,packageName,tag,nid,key){return JSON.stringify({c:code,n:nid,t:tag,p:packageName,k:key})}function parseNotificationId(id){var n=JSON.parse(id);return{"package":n.p,code:n.c,nid:n.n,tag:n.t,key:n.k}}function getInstanceID(callback){if(typeof callback!=="function")return;if(chrome.instanceID){chrome.instanceID.getID(function(iid){if(callback){callback(iid)}})}else{callback("notimplementedyet")}}function getBrowserLanguages(){if(Array.isArray(navigator.languages)){return navigator.languages.join(",")}else{return navigator.language}}function isIconCached(packageName){return localStorage.getItem("i:"+packageName)!==null}function getCachedIcon(packageName){return localStorage.getItem("i:"+packageName)}function setCachedIcon(packageName){if(!packageName)return;if(DEBUG)console.log("trying to add "+packageName+"to icon cache");var icon=new Image;icon.onload=function(){if(DEBUG)console.log("loaded icon for "+packageName);var size=80;var canvas=document.createElement("canvas");canvas.width=size;canvas.height=size;var ctx=canvas.getContext("2d");if(icon.width>size)icon.width=size;if(icon.height>size)icon.height=size;var x=Math.round((canvas.width-icon.width)/2);var y=Math.round((canvas.height-icon.height)/2);ctx.drawImage(icon,x,y,icon.width,icon.height);if(DEBUG){ctx.fillStyle="red";ctx.fillRect(0,0,10,10)}try{localStorage.setItem("i:"+packageName,canvas.toDataURL());if(DEBUG)console.log("successfully stored icon for "+packageName+" in the cache!")}catch(e){console.log("error when trying to store icon for "+packageName+" in the cache: "+e)}};icon.src=URL_ICON+packageName}function surveyShowNotification(){var options={type:"basic",iconUrl:"images/icon_survey_80.png",title:"Survey",message:"Participate in a short survey to improve Desktop Notifications?",buttons:[{title:"Yes"},{title:"No"}],priority:1,isClickable:false};chrome.notifications.create("_survey",options,function(){})}function surveyActionParticipate(){chrome.notifications.clear("_survey",function(){});chrome.tabs.create({url:chrome.extension.getURL("survey.html")},function(){})}function surveyActionDismiss(){chrome.notifications.clear("_survey",function(){});chrome.identity.getAuthToken({interactive:false},function(token){if(token){chrome.storage.local.get(["device"],function(items){var device=items.device||"unknown";getInstanceID(function(iid){var data={time:Date.now(),device:device,iid:iid,lang:getBrowserLanguages(),version:VERSION,type:TYPE,declined:true};$.post(URL_SURVEY,{sid:SURVEY_ID,token:token,data:JSON.stringify(data)},function(){})})})}})}