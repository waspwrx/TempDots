$(document).ready(function(){"use strict";var VIEW_SIGN_IN=0;var VIEW_SIGNED_IN=2;var VIEW_LOADING=3;var signInClicked=false;var dismissAllClicked=false;var showSettings=DEFAULT_SETTINGS;var actionList={};var iconList={};loadConfig("/config/actions.json",function(json){actionList=json});loadConfig("/config/icons.json",function(json){iconList=json});function displayMode(mode){switch(mode){case VIEW_SIGN_IN:$("#view-sign-in").show();$("#view-loading").hide();$("#view-signed-in").hide();break;case VIEW_SIGNED_IN:$("#view-sign-in").hide();$("#view-loading").hide();$("#view-signed-in").show();break;case VIEW_LOADING:$("#view-sign-in").hide();$("#view-loading").show();$("#view-signed-in").hide();break;default:if(DEBUG)console.log("display mode: unknown view")}}var audio=null;setTimeout(function(){try{audio=new Audio("sounds/new.ogg")}catch(error){if(DEBUG)console.log(error)}},1e3);if(!navigator.onLine){$("#offline-warning").show()}window.addEventListener("online",function(){$("#offline-warning").hide()},false);window.addEventListener("offline",function(){$("#offline-warning").show()},false);var version=window.navigator.userAgent.match(/Chrome\/(.+?)\./);if(version!=null&&Array.isArray(version)&&version.length>0){if(+version[1]<MIN_VERSION){$("#version").show()}}if(window.navigator.userAgent.indexOf("Firefox")!==-1||window.navigator.userAgent.indexOf("OPR")!==-1||window.navigator.userAgent.indexOf("Vivaldi")!==-1){$("#browser").show()}chrome.storage.local.get(["duration","badge","sound","speak","remember","settings"],function(items){$("#duration").val(items.duration||DEFAULT_DURATION);$("#badge").prop("checked",items.badge||DEFAULT_BADGE);$("#sound").prop("checked",items.sound||DEFAULT_SOUND);$("#speak").prop("checked",items.speak||DEFAULT_SPEAK);$("#remember").prop("checked",items.remember||DEFAULT_REMEMBER);showSettings=typeof items.settings!=="undefined"?items.settings:DEFAULT_SETTINGS;if(!showSettings){$("#settings-block").hide()}});$("#duration").change(function(){chrome.storage.local.set({duration:$(this).val()},function(){})});$("#badge").change(function(){var s=$(this);chrome.storage.local.set({badge:s.prop("checked")},function(){})});$("#sound").change(function(){var s=$(this);if(s.prop("checked")&&audio!=null){audio.play()}chrome.storage.local.set({sound:s.prop("checked")},function(){})});$("#speak").change(function(){var s=$(this);if(s.prop("checked")){var msg=chrome.i18n.getMessage("hello_world");chrome.tts.speak(msg,{lang:DEFAULT_TTS_LANG})}chrome.storage.local.set({speak:s.prop("checked")},function(){})});$("#remember").change(function(){var s=$(this);chrome.storage.local.set({remember:s.prop("checked")},function(){})});$("#toggle-settings").on("click",function(){showSettings=!showSettings;chrome.storage.local.set({settings:showSettings},function(){});$("#settings-block").toggle()});$("#signin").click(function(){if(signInClicked){return}signInClicked=true;displayMode(VIEW_LOADING);chrome.runtime.sendMessage({action:"sign_in"},function(success){if(success){displayMode(VIEW_SIGNED_IN);getNotifications()}else{displayMode(VIEW_SIGN_IN)}signInClicked=false})});$("#signout").click(function(){chrome.runtime.sendMessage({action:"sign_out"},function(){displayMode(VIEW_SIGN_IN)});return false});$("#devices").click(function(){chrome.windows.create({url:"devices.html",type:"popup",height:450,width:350})});chrome.runtime.sendMessage({action:"check_sign_in"},function(signedIn){if(signedIn){displayMode(VIEW_SIGNED_IN);getNotifications()}else{displayMode(VIEW_SIGN_IN)}});function getNotifications(){if(DEBUG)console.log("getNotifications()");chrome.runtime.sendMessage({action:"get_notifications"},function(list){showNotifications(list)})}function showNotifications(list){if(DEBUG)console.log("showNotifications()");if(list.length==0){$("#no-notifications").show();$("#notification-list").hide();$("#notification-options").hide()}else{$("#no-notifications").hide();if(list.length>=1){$("#notification-options").show()}else{$("#notification-options").hide()}$("#notification-list").empty().show();for(var i=0;i<list.length;i++){renderNotification(list[i])}}}function renderNotification(n){if(DEBUG)console.log("renderNotification()");var t=document.querySelector("#notification-template");if(FLAG_NEW_STYLE){t=document.querySelector("#notification-template-2")}var title=n.title;var content=n.content;if(n.limited!==undefined&&n.limited==1){title="Desktop Notifications";content=n.appname}if(n.package=="com.android.systemui"&&n.tag=="low_battery"){t.content.querySelector(".appicon").src="images/appicons/org.hcilab.projects.notification.battery.low.webp"}else{}if(iconList[n.package]!==undefined){t.content.querySelector(".appicon").src="images/appicons/"+n.package+iconList[n.package]}else if(isIconCached(n.package)){t.content.querySelector(".appicon").src=getCachedIcon(n.package)}else{t.content.querySelector(".appicon").src="images/appicons/org.hcilab.projects.notification.png"}t.content.querySelector(".appname").textContent=n.appname;t.content.querySelector(".appicon").title=n.appname;t.content.querySelector(".title").textContent=title;t.content.querySelector(".content").textContent=content;t.content.querySelector(".device").textContent=n.dn;t.content.querySelector(".time").textContent=new Date(+n.time).toLocaleTimeString();t.content.querySelector(".title").innerHTML=Autolinker.link(t.content.querySelector(".title").innerHTML);t.content.querySelector(".content").innerHTML=Autolinker.link(t.content.querySelector(".content").innerHTML);if(actionList[n.package]!==undefined){t.content.querySelector(".button-container").style.display="block";t.content.querySelector(".button-text").textContent=chrome.i18n.getMessage(actionList[n.package]["title"]);t.content.querySelector(".button-text").href=actionList[n.package]["url"];t.content.querySelector(".button-text").title=actionList[n.package]["url"]}else{t.content.querySelector(".button-container").style.display="none"}t.content.querySelector(".close-button").title=chrome.i18n.getMessage("popup_list_clear_notification");t.content.querySelector(".close-button").dataset.id=n.id;var clone=document.importNode(t.content,true);clone.querySelector(".close-button").onclick=function(){chrome.runtime.sendMessage({action:"dismiss_notification",id:this.dataset.id},function(list){showNotifications(list)})};document.querySelector("#notification-list").appendChild(clone)}$("#clear-all-notifications").on("click",function(){if(!dismissAllClicked){dismissAllClicked=true;chrome.runtime.sendMessage({action:"dismiss_all_notifications"},function(list){showNotifications([]);dismissAllClicked=false})}});chrome.runtime.onMessage.addListener(function(message,sender,response){var action=message.action;switch(action){case"event":getNotifications();response();return true}return true});$("#i18n-page-title").text(chrome.i18n.getMessage("popup_title"));$("#i18n-title-1").text(chrome.i18n.getMessage("popup_title"));$("#i18n-sign-in-intro-1").text(chrome.i18n.getMessage("popup_sign_in_intro_1"));$("#i18n-sign-in-intro-2").text(chrome.i18n.getMessage("popup_sign_in_intro_2"));$("#i18n-sign-in-app").text(chrome.i18n.getMessage("popup_sign_in_app"));$("#i18n-sign-in-contact").text(chrome.i18n.getMessage("popup_sign_in_contact"));$("#i18n-sign-in-troubleshooting").text(chrome.i18n.getMessage("popup_sign_in_troubleshooting"));$("#i18n-loading").attr("alt",chrome.i18n.getMessage("popup_loading")).attr("title",chrome.i18n.getMessage("popup_loading"));$("#i18n-title-2").text(chrome.i18n.getMessage("popup_title"));$("#i18n-menu-devices").text(chrome.i18n.getMessage("popup_menu_devices"));$("#i18n-menu-toggle-settings").text(chrome.i18n.getMessage("popup_menu_toggle_settings"));$("#i18n-menu-android-app").text(chrome.i18n.getMessage("popup_menu_android_app"));$("#i18n-menu-android-tv-app").text(chrome.i18n.getMessage("popup_menu_android_tv_app"));$("#i18n-menu-plus-community").text(chrome.i18n.getMessage("popup_menu_plus_community"));$("#i18n-menu-contact").text(chrome.i18n.getMessage("popup_menu_contact"));$("#i18n-menu-troubleshooting").text(chrome.i18n.getMessage("popup_menu_troubleshooting"));$("#i18n-menu-sign-out").text(chrome.i18n.getMessage("popup_menu_sign_out"));$("#i18n-settings-duration-text").text(chrome.i18n.getMessage("popup_settings_duration_text"));$("#i18n-settings-duration-option-0").text(chrome.i18n.getMessage("popup_settings_duration_option_0"));$("#i18n-settings-duration-option-1").text(chrome.i18n.getMessage("popup_settings_duration_option_1"));$("#i18n-settings-duration-option-2").text(chrome.i18n.getMessage("popup_settings_duration_option_2"));$("#i18n-settings-duration-option-3").text(chrome.i18n.getMessage("popup_settings_duration_option_3"));$("#i18n-settings-duration-option-4").text(chrome.i18n.getMessage("popup_settings_duration_option_4"));$("#i18n-settings-duration-option-5").text(chrome.i18n.getMessage("popup_settings_duration_option_5"));$("#i18n-settings-duration-option-6").text(chrome.i18n.getMessage("popup_settings_duration_option_6"));$("#i18n-settings-duration-option-7").text(chrome.i18n.getMessage("popup_settings_duration_option_7"));$("#i18n-settings-duration-option-8").text(chrome.i18n.getMessage("popup_settings_duration_option_8"));$("#i18n-settings-duration-option-9").text(chrome.i18n.getMessage("popup_settings_duration_option_9"));$("#i18n-settings-duration-option-10").text(chrome.i18n.getMessage("popup_settings_duration_option_10"));$("#i18n-settings-duration-option-11").text(chrome.i18n.getMessage("popup_settings_duration_option_11"));$("#i18n-settings-duration-option-12").text(chrome.i18n.getMessage("popup_settings_duration_option_12"));$("#i18n-settings-duration-option-13").text(chrome.i18n.getMessage("popup_settings_duration_option_13"));$("#i18n-settings-duration-option-14").text(chrome.i18n.getMessage("popup_settings_duration_option_14"));$("#i18n-settings-duration-option-15").text(chrome.i18n.getMessage("popup_settings_duration_option_15"));$("#i18n-settings-duration-option-16").text(chrome.i18n.getMessage("popup_settings_duration_option_16"));$("#i18n-settings-duration-option-17").text(chrome.i18n.getMessage("popup_settings_duration_option_17"));$("#i18n-settings-duration-option-18").text(chrome.i18n.getMessage("popup_settings_duration_option_18"));$("#i18n-settings-duration-option-19").text(chrome.i18n.getMessage("popup_settings_duration_option_19"));$("#i18n-settings-duration-option-20").text(chrome.i18n.getMessage("popup_settings_duration_option_20"));$("#i18n-settings-duration-option-21").text(chrome.i18n.getMessage("popup_settings_duration_option_21"));$("#i18n-settings-duration-option-22").text(chrome.i18n.getMessage("popup_settings_duration_option_22"));$("#i18n-settings-duration-option-23").text(chrome.i18n.getMessage("popup_settings_duration_option_23"));$("#i18n-settings-duration-option-24").text(chrome.i18n.getMessage("popup_settings_duration_option_24"));$("#i18n-settings-duration-option-25").text(chrome.i18n.getMessage("popup_settings_duration_option_25"));$("#i18n-settings-duration-option-999").text(chrome.i18n.getMessage("popup_settings_duration_option_999"));$("#i18n-settings-badge").text(chrome.i18n.getMessage("popup_settings_badge"));$("#i18n-settings-sound").text(chrome.i18n.getMessage("popup_settings_sound"));$("#i18n-settings-speak").text(chrome.i18n.getMessage("popup_settings_speak"));$("#i18n-settings-speak-experimental").text(chrome.i18n.getMessage("popup_settings_speak_experimental"));$("#i18n-settings-remember").text(chrome.i18n.getMessage("popup_settings_remember"));$("#i18n-list-no-notifications").text(chrome.i18n.getMessage("popup_list_no_notifications"));$("#i18n-offline-warning").text(chrome.i18n.getMessage("popup_offline_warning"))});